<!DOCTYPE html>
<html lang="en">
  <html>
    <head>
      <title>Sign Up</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <meta charset="utf-8" />
      <link rel="stylesheet" type="text/css" href="css/signup_style.css" />
      <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
      />
      <link
        href="https://fonts.googleapis.com/css?family=Titillium+Web:400,300,600"
        rel="stylesheet"
        type="text/css"
      />
      <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css" integrity="sha384-vp86vTRFVJgpjF9jiIGPEEqYqlDwgyBgEF109VFjmqGmIY/Y4HV4d3Gp2irVfcrp" crossorigin="anonymous">
    </head>

    <body class="body">
      <div class="login-page">
        <div class="form">
          <div>
            <lottie-player
              src="https://assets4.lottiefiles.com/datafiles/XRVoUu3IX4sGWtiC3MPpFnJvZNq7lVWDCa8LSqgS/profile.json"
              background="transparent"
              speed="1"
              style="justify-content: center"
              loop
              autoplay
            ></lottie-player>
            <input type="text" id="name" placeholder="full name" / required>
            <input type="email" id="email" placeholder="email address" / required>
            
            <input type="password" id="password" placeholder="set a password" / required>
            <i class="fas fa-eye" onclick="show()"></i>
            <br>
            <br>
          </div>

          <div class="login-form">
            <button type="button" id="signup">
              SIGN UP
            </button>
            <a href="/login">Go to Login</a>
          </div>
        </div>
      </div>
    </body>
    <script>
      function show() {
        var password = document.getElementById("password");
        var icon = document.querySelector(".fas");

        // ========== Checking type of password ===========
        if (password.type === "password") {
          password.type = "text";
        } else {
          password.type = "password";
        }
      }
    </script>
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js";
    import {getDatabase, set, ref, update} from "https://www.gstatic.com/firebasejs/9.6.6/firebase-database.js";
    import { getAuth,signInWithRedirect, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-auth.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    const firebaseConfig = {
    apiKey: "AIzaSyAKMv09AYbmmB9C75v_VdoBufavjDOeHN0",
    authDomain: "walkover-docs-platform.firebaseapp.com",
    databaseURL: "https://walkover-docs-platform-default-rtdb.firebaseio.com",
    projectId: "walkover-docs-platform",
    storageBucket: "walkover-docs-platform.appspot.com",
    messagingSenderId: "298736667390",
    appId: "1:298736667390:web:916c963ccc86a659d973af"
  };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const auth = getAuth();
      
      signup.addEventListener('click',(e) => {
      
      var email = document.getElementById('email').value;
      var password = document.getElementById('password').value;
      var username = document.getElementById('name').value;
      
      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
         // Signed in 
        const user = userCredential.user;
      
        set(ref(database,'users/'+ user.uid),{
          username: username,
          email: email
        });
      
        alert('user created!');
        
        // ...
        })
        .catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;
       
        if(new String(errorMessage).valueOf() == ("Error (auth/email-already-in-use)."))
          window.location.href = 'login.ejs';
          else		alert(errorMessage);
    
        // ..
        });
      
      });
    
    // const user = auth.currentUser;
    // onAuthStateChanged(auth, (user) => {
    //   if (user) {
    //     // User is signed in, see docs for a list of available properties
    //     // https://firebase.google.com/docs/reference/js/firebase.User
    //     //const uid = user.uid;
      
    //      //window.location.href = 'login.html';
    
    //     // ...
    //   } else {
    //     // User is signed out
    //     // ...
    //   }
    // });
    
    </script>
  </html>
</html>